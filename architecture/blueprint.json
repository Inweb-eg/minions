{
  "id": "BP-1766965617615",
  "version": "1.0.7",
  "createdAt": "2025-12-28T23:46:57.615Z",
  "updatedAt": "2025-12-28T23:46:57.615Z",
  "metadata": {
    "projectName": "Minions Project",
    "description": "Self-evolution from v2.0 to v3.0",
    "generatedBy": "Architect-Agent",
    "basedOn": "BP-1766965609819"
  },
  "pattern": {
    "primary": "modular-monolith",
    "secondary": "layered",
    "rationale": "Modular monolith provides good balance of simplicity and maintainability"
  },
  "components": {
    "backend": {
      "type": "backend",
      "name": "Backend API",
      "technology": {
        "framework": "express",
        "name": "Express.js",
        "version": "^4.18.2",
        "language": "javascript",
        "runtime": "node",
        "runtimeVersion": ">=18.0.0",
        "packageManager": "npm",
        "dependencies": [
          "cors",
          "helmet",
          "morgan",
          "compression"
        ],
        "rationale": "Strengths: Mature ecosystem, Large community"
      },
      "structure": {
        "entryPoint": "src/index.js",
        "routes": "src/routes/",
        "controllers": "src/controllers/",
        "services": "src/services/",
        "models": "src/models/",
        "middleware": "src/middleware/",
        "utils": "src/utils/",
        "config": "src/config/"
      },
      "features": [
        "User authentication & authorization",
        "CRUD operations for core entities",
        "Real-time communication (WebSocket)",
        "File upload handling",
        "Payment integration",
        "Push notifications"
      ],
      "authentication": {
        "strategy": "JWT",
        "provider": "local",
        "tokenExpiry": "24h",
        "refreshToken": true
      },
      "database": {
        "type": "mongodb",
        "orm": "mongoose",
        "migrations": true
      },
      "api": {
        "style": "REST",
        "versioning": "url",
        "documentation": "swagger"
      }
    },
    "admin": {
      "type": "frontend-web",
      "name": "Admin Dashboard",
      "technology": {
        "framework": "react",
        "name": "React",
        "version": "^18.2.0",
        "stateManagement": "redux-toolkit",
        "stateManagementVersion": "^2.0.0",
        "routing": "react-router-dom",
        "styling": "tailwindcss",
        "ui": "shadcn-ui",
        "dependencies": [
          "react-dom",
          "react-router-dom",
          "react-redux"
        ],
        "buildTool": "vite",
        "rationale": "Strengths: Large ecosystem, Component model"
      },
      "structure": {
        "entryPoint": "src/index.jsx",
        "pages": "src/pages/",
        "components": "src/components/",
        "hooks": "src/hooks/",
        "services": "src/services/",
        "store": "src/store/",
        "utils": "src/utils/",
        "styles": "src/styles/"
      },
      "stateManagement": {
        "library": "redux-toolkit",
        "pattern": "slices",
        "middleware": [
          "thunk"
        ]
      },
      "routing": {
        "library": "react-router-dom",
        "authGuards": true
      },
      "features": [
        "Dashboard with analytics",
        "User management",
        "Driver management",
        "Ride monitoring",
        "Reports & exports",
        "Settings & configuration"
      ]
    },
    "mobile": {
      "users": {
        "type": "frontend-mobile",
        "name": "Users App",
        "technology": {
          "framework": "flutter",
          "name": "Flutter",
          "version": "^3.16.0",
          "language": "dart",
          "stateManagement": "provider",
          "stateManagementVersion": "^6.1.0",
          "dependencies": [
            "provider",
            "dio",
            "shared_preferences",
            "flutter_secure_storage"
          ],
          "rationale": "Strengths: Single codebase, Fast development"
        },
        "structure": {
          "entryPoint": "lib/main.dart",
          "screens": "lib/screens/",
          "widgets": "lib/widgets/",
          "providers": "lib/providers/",
          "services": "lib/services/",
          "models": "lib/models/",
          "utils": "lib/utils/"
        },
        "stateManagement": {
          "library": "provider",
          "pattern": "changeNotifier"
        },
        "features": [
          "User registration & login",
          "Profile management",
          "Ride booking",
          "Real-time tracking",
          "Payment methods",
          "Ride history",
          "Ratings & reviews"
        ]
      },
      "drivers": {
        "type": "frontend-mobile",
        "name": "Drivers App",
        "technology": {
          "framework": "flutter",
          "name": "Flutter",
          "version": "^3.16.0",
          "language": "dart",
          "stateManagement": "provider",
          "stateManagementVersion": "^6.1.0",
          "dependencies": [
            "provider",
            "dio",
            "shared_preferences",
            "flutter_secure_storage"
          ],
          "rationale": "Strengths: Single codebase, Fast development"
        },
        "structure": {
          "entryPoint": "lib/main.dart",
          "screens": "lib/screens/",
          "widgets": "lib/widgets/",
          "providers": "lib/providers/",
          "services": "lib/services/",
          "models": "lib/models/",
          "utils": "lib/utils/"
        },
        "stateManagement": {
          "library": "provider",
          "pattern": "changeNotifier"
        },
        "features": [
          "Driver registration & verification",
          "Availability toggle",
          "Ride requests",
          "Navigation integration",
          "Earnings dashboard",
          "Document management"
        ]
      }
    },
    "shared": {
      "name": "Shared Libraries",
      "packages": {
        "api-client": "Shared API client for all frontends",
        "common-types": "Shared TypeScript/Dart types",
        "validation": "Shared validation rules",
        "constants": "Shared constants and enums"
      }
    },
    "infrastructure": {
      "docker": {
        "backend": "Dockerfile.backend",
        "admin": "Dockerfile.admin",
        "compose": "docker-compose.yml"
      },
      "ci_cd": {
        "provider": "github-actions",
        "pipelines": [
          "test",
          "build",
          "deploy"
        ]
      },
      "monitoring": {
        "logging": "winston",
        "metrics": "prometheus",
        "tracing": "opentelemetry"
      }
    }
  },
  "layers": {
    "presentation": {
      "name": "Presentation",
      "order": 1,
      "components": [
        "Admin Dashboard",
        "Users App",
        "Drivers App"
      ],
      "responsibilities": [
        "User interface rendering",
        "User input handling",
        "View state management",
        "API consumption"
      ],
      "allowedDependencies": [
        "application"
      ]
    },
    "application": {
      "name": "Application",
      "order": 2,
      "components": [
        "Backend API - Controllers",
        "Backend API - Services"
      ],
      "responsibilities": [
        "Business logic orchestration",
        "Transaction management",
        "Authorization enforcement",
        "DTO transformations"
      ],
      "allowedDependencies": [
        "domain",
        "infrastructure"
      ]
    },
    "domain": {
      "name": "Domain",
      "order": 3,
      "components": [
        "Backend API - Models",
        "Backend API - Business Rules"
      ],
      "responsibilities": [
        "Core business entities",
        "Business rules and validations",
        "Domain events",
        "Value objects"
      ],
      "allowedDependencies": []
    },
    "infrastructure": {
      "name": "Infrastructure",
      "order": 4,
      "components": [
        "Database",
        "External Services",
        "Message Queue"
      ],
      "responsibilities": [
        "Data persistence",
        "External API integration",
        "Caching",
        "File storage"
      ],
      "allowedDependencies": [
        "domain"
      ]
    }
  },
  "boundaries": {
    "contexts": [
      {
        "name": "User Management",
        "owner": "Backend-Agent",
        "entities": [
          "User",
          "Profile",
          "Authentication"
        ],
        "boundaries": {
          "exposes": [
            "UserService",
            "AuthService"
          ],
          "consumes": []
        }
      },
      {
        "name": "Ride Management",
        "owner": "Backend-Agent",
        "entities": [
          "Ride",
          "Route",
          "Pricing"
        ],
        "boundaries": {
          "exposes": [
            "RideService",
            "PricingService"
          ],
          "consumes": [
            "UserService",
            "DriverService"
          ]
        }
      },
      {
        "name": "Driver Management",
        "owner": "Backend-Agent",
        "entities": [
          "Driver",
          "Vehicle",
          "Availability"
        ],
        "boundaries": {
          "exposes": [
            "DriverService",
            "VehicleService"
          ],
          "consumes": [
            "UserService"
          ]
        }
      },
      {
        "name": "Payment Processing",
        "owner": "Backend-Agent",
        "entities": [
          "Payment",
          "Transaction",
          "Refund"
        ],
        "boundaries": {
          "exposes": [
            "PaymentService"
          ],
          "consumes": [
            "UserService",
            "RideService"
          ]
        }
      },
      {
        "name": "Notifications",
        "owner": "Backend-Agent",
        "entities": [
          "Notification",
          "Template",
          "Channel"
        ],
        "boundaries": {
          "exposes": [
            "NotificationService"
          ],
          "consumes": [
            "UserService",
            "DriverService"
          ]
        }
      }
    ],
    "rules": [
      {
        "id": "BOUNDARY-001",
        "rule": "Contexts may only communicate through exposed services",
        "severity": "ERROR"
      },
      {
        "id": "BOUNDARY-002",
        "rule": "Direct database access across contexts is forbidden",
        "severity": "ERROR"
      },
      {
        "id": "BOUNDARY-003",
        "rule": "Shared types must be defined in common package",
        "severity": "WARNING"
      }
    ]
  },
  "dataFlow": {
    "patterns": [
      {
        "name": "Request-Response",
        "description": "Standard synchronous API calls",
        "usage": [
          "REST endpoints",
          "GraphQL queries"
        ]
      },
      {
        "name": "Event-Driven",
        "description": "Asynchronous event publishing",
        "usage": [
          "Notifications",
          "Analytics",
          "Audit logging"
        ]
      },
      {
        "name": "Real-Time",
        "description": "WebSocket connections for live updates",
        "usage": [
          "Ride tracking",
          "Chat",
          "Status updates"
        ]
      }
    ],
    "flows": [
      {
        "name": "User Authentication Flow",
        "steps": [
          {
            "from": "Mobile App",
            "to": "API Gateway",
            "action": "Login Request"
          },
          {
            "from": "API Gateway",
            "to": "Auth Service",
            "action": "Validate Credentials"
          },
          {
            "from": "Auth Service",
            "to": "Database",
            "action": "Query User"
          },
          {
            "from": "Auth Service",
            "to": "API Gateway",
            "action": "Return JWT"
          },
          {
            "from": "API Gateway",
            "to": "Mobile App",
            "action": "Login Response"
          }
        ]
      },
      {
        "name": "Ride Booking Flow",
        "steps": [
          {
            "from": "Users App",
            "to": "Backend",
            "action": "Request Ride"
          },
          {
            "from": "Backend",
            "to": "Pricing Service",
            "action": "Calculate Price"
          },
          {
            "from": "Backend",
            "to": "Driver Service",
            "action": "Find Nearby Drivers"
          },
          {
            "from": "Backend",
            "to": "Notification Service",
            "action": "Notify Drivers"
          },
          {
            "from": "Drivers App",
            "to": "Backend",
            "action": "Accept Ride"
          },
          {
            "from": "Backend",
            "to": "Users App",
            "action": "Ride Confirmed (WebSocket)"
          }
        ]
      }
    ]
  },
  "security": {
    "authentication": {
      "method": "JWT",
      "storage": "httpOnly cookies (web), secure storage (mobile)",
      "expiry": {
        "accessToken": "15m",
        "refreshToken": "7d"
      },
      "mfa": {
        "enabled": true,
        "methods": [
          "sms",
          "totp"
        ]
      }
    },
    "authorization": {
      "model": "RBAC",
      "roles": [
        "user",
        "driver",
        "admin",
        "super_admin"
      ],
      "permissions": {
        "user": [
          "read:own_profile",
          "create:ride",
          "read:own_rides"
        ],
        "driver": [
          "read:own_profile",
          "accept:ride",
          "update:ride_status"
        ],
        "admin": [
          "read:all_users",
          "read:all_rides",
          "manage:drivers"
        ],
        "super_admin": [
          "*"
        ]
      }
    },
    "dataProtection": {
      "encryption": {
        "atRest": "AES-256",
        "inTransit": "TLS 1.3"
      },
      "pii": {
        "fields": [
          "email",
          "phone",
          "address",
          "payment_info"
        ],
        "handling": "encrypted, access-logged"
      }
    },
    "apiSecurity": {
      "rateLimiting": {
        "enabled": true,
        "limits": {
          "anonymous": "100/hour",
          "authenticated": "1000/hour",
          "admin": "5000/hour"
        }
      },
      "cors": {
        "origins": [
          "admin.domain.com",
          "localhost:3000"
        ],
        "methods": [
          "GET",
          "POST",
          "PUT",
          "DELETE"
        ],
        "credentials": true
      },
      "headers": [
        "X-Content-Type-Options: nosniff",
        "X-Frame-Options: DENY",
        "Content-Security-Policy: default-src self"
      ]
    }
  },
  "scalability": {
    "horizontal": {
      "backend": {
        "strategy": "stateless",
        "minInstances": 2,
        "maxInstances": 10,
        "scalingMetric": "cpu",
        "threshold": 70
      },
      "database": {
        "strategy": "replica-set",
        "readReplicas": 2
      }
    },
    "vertical": {
      "recommendations": {
        "backend": {
          "cpu": "2 cores",
          "memory": "4GB"
        },
        "database": {
          "cpu": "4 cores",
          "memory": "8GB"
        }
      }
    },
    "caching": {
      "strategy": "cache-aside",
      "provider": "redis",
      "ttl": {
        "userSessions": "24h",
        "rideData": "5m",
        "staticData": "1h"
      }
    },
    "loadBalancing": {
      "strategy": "round-robin",
      "healthCheck": "/health",
      "stickySession": false
    }
  },
  "crossCutting": {
    "logging": {
      "library": "winston",
      "levels": [
        "error",
        "warn",
        "info",
        "debug"
      ],
      "format": "json",
      "transports": [
        "console",
        "file",
        "cloudwatch"
      ],
      "correlation": {
        "enabled": true,
        "header": "X-Correlation-ID"
      }
    },
    "errorHandling": {
      "strategy": "centralized",
      "middleware": "errorHandler.js",
      "reporting": {
        "service": "sentry",
        "environments": [
          "production",
          "staging"
        ]
      }
    },
    "validation": {
      "library": "joi",
      "location": "middleware",
      "sanitization": true
    },
    "monitoring": {
      "metrics": {
        "library": "prom-client",
        "endpoint": "/metrics"
      },
      "healthCheck": {
        "endpoint": "/health",
        "checks": [
          "database",
          "redis",
          "external-apis"
        ]
      },
      "alerting": {
        "provider": "pagerduty",
        "thresholds": {
          "errorRate": "5%",
          "latencyP99": "2s",
          "availability": "99.9%"
        }
      }
    },
    "documentation": {
      "api": {
        "format": "openapi-3.0",
        "generator": "swagger-jsdoc",
        "ui": "swagger-ui-express"
      },
      "code": {
        "format": "jsdoc",
        "generator": "documentation.js"
      }
    }
  },
  "rules": [
    {
      "id": "RULE-001",
      "name": "Layer Dependency Direction",
      "description": "Dependencies must flow downward: Presentation → Application → Domain ← Infrastructure",
      "severity": "ERROR",
      "pattern": "layer-dependency"
    },
    {
      "id": "RULE-002",
      "name": "No Direct Database Access from Controllers",
      "description": "Controllers must use services, never access database directly",
      "severity": "ERROR",
      "pattern": "controller-no-db"
    },
    {
      "id": "RULE-003",
      "name": "API Versioning Required",
      "description": "All API routes must be versioned (/api/v1/...)",
      "severity": "WARNING",
      "pattern": "api-versioning"
    },
    {
      "id": "RULE-004",
      "name": "Service Isolation",
      "description": "Services should not directly call other services; use events for cross-service communication",
      "severity": "WARNING",
      "pattern": "service-isolation"
    },
    {
      "id": "RULE-005",
      "name": "Model Validation",
      "description": "All models must have validation schemas",
      "severity": "ERROR",
      "pattern": "model-validation"
    },
    {
      "id": "RULE-006",
      "name": "Error Handling",
      "description": "All async operations must have proper error handling",
      "severity": "ERROR",
      "pattern": "error-handling"
    },
    {
      "id": "RULE-007",
      "name": "Authentication Required",
      "description": "All non-public routes must require authentication",
      "severity": "ERROR",
      "pattern": "auth-required"
    },
    {
      "id": "RULE-008",
      "name": "Input Sanitization",
      "description": "All user inputs must be sanitized before processing",
      "severity": "ERROR",
      "pattern": "input-sanitization"
    }
  ],
  "techStack": {
    "id": "STACK-1766965617614",
    "createdAt": "2025-12-28T23:46:57.614Z",
    "backend": {
      "framework": "express",
      "name": "Express.js",
      "version": "^4.18.2",
      "language": "javascript",
      "runtime": "node",
      "runtimeVersion": ">=18.0.0",
      "packageManager": "npm",
      "dependencies": [
        "cors",
        "helmet",
        "morgan",
        "compression"
      ],
      "rationale": "Strengths: Mature ecosystem, Large community"
    },
    "database": {
      "type": "mongodb",
      "name": "MongoDB",
      "version": "latest",
      "dbType": "nosql",
      "orm": "mongoose",
      "ormVersion": "^8.0.0",
      "migrations": true,
      "seeding": true,
      "rationale": "Strengths: Flexible schema, Scalable"
    },
    "cache": {
      "type": "redis",
      "name": "Redis",
      "version": "7",
      "clientVersion": "^4.6.0",
      "useCases": [
        "sessions",
        "caching",
        "rate-limiting",
        "pub-sub"
      ],
      "rationale": "Redis is the industry standard for caching and session management"
    },
    "admin": {
      "framework": "react",
      "name": "React",
      "version": "^18.2.0",
      "stateManagement": "redux-toolkit",
      "stateManagementVersion": "^2.0.0",
      "routing": "react-router-dom",
      "styling": "tailwindcss",
      "ui": "shadcn-ui",
      "dependencies": [
        "react-dom",
        "react-router-dom",
        "react-redux"
      ],
      "buildTool": "vite",
      "rationale": "Strengths: Large ecosystem, Component model"
    },
    "mobile": {
      "framework": "flutter",
      "name": "Flutter",
      "version": "^3.16.0",
      "language": "dart",
      "stateManagement": "provider",
      "stateManagementVersion": "^6.1.0",
      "dependencies": [
        "provider",
        "dio",
        "shared_preferences",
        "flutter_secure_storage"
      ],
      "rationale": "Strengths: Single codebase, Fast development"
    },
    "testing": {
      "unit": "jest",
      "unitVersion": "^29.7.0",
      "integration": "supertest",
      "e2e": "playwright",
      "mobile": "flutter_test",
      "coverage": {
        "tool": "istanbul",
        "threshold": {
          "branches": 80,
          "functions": 80,
          "lines": 80,
          "statements": 80
        }
      },
      "rationale": "Industry-standard testing tools with good coverage reporting"
    },
    "cicd": {
      "platform": "github-actions",
      "name": "GitHub Actions",
      "pipelines": [
        {
          "name": "test",
          "triggers": [
            "push",
            "pull_request"
          ],
          "steps": [
            "lint",
            "test",
            "coverage"
          ]
        },
        {
          "name": "build",
          "triggers": [
            "push:main"
          ],
          "steps": [
            "test",
            "build",
            "docker-build"
          ]
        },
        {
          "name": "deploy",
          "triggers": [
            "release"
          ],
          "steps": [
            "test",
            "build",
            "deploy-staging",
            "deploy-production"
          ]
        }
      ],
      "rationale": "Native GitHub integration with generous free tier"
    },
    "monitoring": {
      "logging": "winston",
      "loggingVersion": "^3.11.0",
      "metrics": "prom-client",
      "metricsVersion": "^15.0.0",
      "errorTracking": "sentry",
      "apm": "datadog",
      "alerting": {
        "provider": "pagerduty",
        "channels": [
          "email",
          "slack"
        ]
      },
      "dashboards": {
        "provider": "grafana",
        "prebuilt": [
          "nodejs",
          "mongodb",
          "redis"
        ]
      },
      "rationale": "Comprehensive monitoring stack with industry-standard tools"
    },
    "versions": {
      "express": "^4.18.2",
      "node": ">=18.0.0",
      "mongodb": "latest",
      "mongoose": "^8.0.0",
      "redis": "7",
      "react": "^18.2.0",
      "redux-toolkit": "^2.0.0",
      "flutter": "^3.16.0",
      "provider": "^6.1.0",
      "jest": "^29.7.0",
      "winston": "^3.11.0",
      "prom-client": "^15.0.0"
    },
    "compatibility": {
      "verified": true,
      "issues": []
    }
  }
}